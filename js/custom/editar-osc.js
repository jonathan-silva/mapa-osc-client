"use strict";require(["jquery-ui","libs/jquery-mask/jquery.mask.min"],function(e){$(document).tooltip({position:{my:"center bottom-20",at:"center top",using:function(e,o){$(this).css(e),$("<div>").addClass("arrow").addClass(o.vertical).addClass(o.horizontal).appendTo(this)}}}),$(".scroll").click(function(e){e.preventDefault(),$("html,body").animate({scrollTop:$(this.hash).offset().top},800)})}),require(["react","rotas","jsx!components/Util","jsx!components/EditarOSC","jquery","jquery-ui","datatables-responsive","editarCabecalho"],function(e){var o,t,a,i=new DataForms,n=new Util,s=new Rotas,r=new Cabecalho,c=new DadosGerais,l=new AreaAtuacao,d=new Descricao,p=new TitulosCertificacoes,u=new RelacoesGovernanca,_=new EspacosPartSocial,h=new Projeto,b=new FonteRecurso,v=null,f={},m=0,g=3,j=1,x=0;require(["componenteFormItem","componenteCabecalho","componenteCheckbox","componenteSection","componenteAgrupador","componenteFormItemButtons","componenteAgrupadorInputProjeto","componenteAgrupadorConferencia","componenteAgrupadorConselhos","componenteTitulosCertificacoes","jquery","select-boxit"],function(k,y,O,C,S,P,R,A,w,D){function T(e,o){var t="";return $.ajax({url:e,async:o,type:"GET",dataType:"json",error:function(e){console.log("Erro no ajax: "),console.log(e)},success:function(e){t=e,console.log(e)}}),t}function E(e,o){var t="";return $.ajax({url:e,async:o,type:"GET",dataType:"json",success:function(e){t=e},error:function(e){}}),t}function I(e,o,t,a,i){$("#objetivosOsc-metas").append('<label title="Objetivo selecionado da ODS." class="label-objetivosOsc-'+a+'">Objetivo:<span class="glyphicon glyphicon-info-sign" style="visibility:visible;"></span></label>'),$("#objetivosOsc-metas").append('<div id="objetivosOsc" class="objetivosOsc objetivosOsc-'+a+'"></div>'),$(".objetivosOsc-"+a).append('<div class="form-group"><div id="objetivosOsc-'+a+'" for="'+a+'"><select class="form-control"></select></div></div>'),$("#objetivosOsc-"+a).append('<div id="metasOsc-'+a+'" class="metasOsc"></div>');var n=$("#objetivosOsc-metas").find("#metasOsc-"+a);a<=-1?n.append('<br><label title="Marque as metas que se enquadram neste projeto" style="display:none">Metas Relacionadas ao ODS definido:<span class="glyphicon glyphicon-info-sign" style="visibility:visible;"></span></label><br>'):n.append('<br><label title="Marque as metas que se enquadram neste projeto">Metas Relacionadas ao ODS definido:<span class="glyphicon glyphicon-info-sign" style="visibility:visible;"></span></label><br>'),n.append('<ol id="selectableOsc-'+a+'" class="selectable"></ol><br>'),function(e,o){var t=e,a=$("#objetivosOsc-"+o).find("select");-1==o?a.append('<option value=-1 selected id="0">Selecione uma opção...</option>'):a.append('<option value=-1 id="0">Selecione uma opção...</option>');for(var i=0;i<t.length;i++)t[i].cd_objetivo_projeto==o?a.append('<option selected id="'+t[i].cd_objetivo_projeto+'">'+t[i].tx_nome_objetivo_projeto+"</option>"):a.append('<option id="'+t[i].cd_objetivo_projeto+'">'+t[i].tx_nome_objetivo_projeto+"</option>")}(e,a),$("#objetivosOsc-"+a+" select").selectBoxIt({theme:"default",autoWidth:!1}),$("#objetivosOsc-"+a+" select").selectBoxIt("refresh");var s=[];if(-1!==t){for(var r=0;r<o.length;r++)if(a==o[r].cd_objetivo_osc){var c=o[r].cd_meta_osc;s.push(c)}M(a,s,i)}!function(e,o){$("#objetivosOsc-"+e).find("select").on("change",function(){var e=$(this).children(":selected").attr("id"),t=!1;$(".objetivosOsc").each(function(){$(this).hasClass("objetivosOsc-"+e)&&(t=!0)});var a=null;t?(a=$(this).parent().attr("for"),$("#metasOsc-"+a).remove()):(a=$(this).parent().attr("for"),$(this).parent().attr("for",e),$(".label-objetivosOsc-"+a).removeClass("label-objetivosOsc-"+a).addClass("label-objetivosOsc-"+e),$(".objetivosOsc-"+a).removeClass("objetivosOsc-"+a).addClass("objetivosOsc-"+e),$("#metasOsc-"+a).remove(),$(this).parent().append('<div id="metasOsc-'+e+'" class="metasOsc"></div>'),$("#metasOsc-"+e).append('<br><label title="Marque as metas que se enquadram neste projeto">Metas Relacionadas ao ODS definido:<span class="glyphicon glyphicon-info-sign" style="visibility:visible;"></span></label><br>'),$("#metasOsc-"+e).append('<ol id="selectableOsc-'+e+'" class="selectable"></ol><br>'),0!==parseInt(e)&&M(e,[],o)),verificarContraste()})}(a,i)}function M(o,t,a){!function(o,t,a,i){if(n.validateObject(o,!1)){for(var s=function(e,o,t,a,i){this.id=e,this.label=o,this.value=t,this.type=a,this.checked=i},r=[],c=o,l=0;l<c.length;l++){var d=null;a.includes(c[l].cd_meta_projeto)?(d=new s(c[l].cd_meta_projeto,c[l].tx_nome_meta_projeto,c[l].cd_meta_projeto,"checkbox",!0),r.push(d)):(d=new s(c[l].cd_meta_projeto,c[l].tx_nome_meta_projeto,c[l].cd_meta_projeto,"checkbox",!1),r.push(d))}i=e.createFactory(i),ReactDOM.render(i({dados:r}),document.getElementById("selectableOsc-"+t))}var p=$("#metasOsc-"+t);p.append('<span class="input-group-btn"><button id="remover_objetivo_ods-'+t+'" for="'+t+'" class="btn-danger btn">Remover Objetivo</button></span>'),p.append("<hr>"),$("#remover_objetivo_ods-"+t).click(function(){var e=$(this).attr("for");$(".label-objetivosOsc-"+e).remove(),$(".objetivosOsc-"+e).remove(),$("#metasOsc-"+e).remove(),m--})}(T(s.MetaProjeto(o),!1),o,t,a)}function q(t,a,i,n,r){function c(e){var t,n=!1;parseInt(e)<=0&&(n=!0);var r=h.carregaProjeto(e,i,s,a,n),c=r.projeto?r.projeto.projeto[0].ft_nome_projeto:"";"Representante de OSC"==c||"Representante"==c?"Projeto excluído."==(o=a.carregaAjax(s.RemoverProjectByID(e,Z),"POST",f)).msg?(t={"Removido com sucesso!":"Suas alterações serão processadas aproximadamente em 1(uma) hora.<br><br>Obrigado!"},a.abrirModalAjuda("Removido com sucesso!",t)):(t={"Problema ao remover projeto!":"Esse projeto possivelmente já foi removido.<br> Suas alterações serão processadas aproximadamente em 1(uma) hora.<br><br>Obrigado!"},a.abrirModalAjuda("Problema ao remover projeto!",t)):parseInt(e)>0?(t={"Problema ao remover projeto!":"Esse projeto possivelmente é um projeto de dados oficiais e não pode ser removido.<br> Suas alterações serão processadas aproximadamente em 1(uma) hora.<br><br>Obrigado!"},a.abrirModalAjuda("Problema ao remover projeto!",t)):(t={"Problema ao remover projeto!":"Esse projeto possivelmente foi inseriodo agora!"},a.abrirModalAjuda("Problema ao remover projeto!",t))}var l=h.montarProjetos(t,a),d=l[0];C=e.createFactory(C),ReactDOM.render(C({dados:[d]}),document.getElementById("projetos")),$("#projetos .sections h2").parent().append('<div class="input-box checkbox pro"><label><input type="checkbox">Não possui projetos, atividades e programas</label></div>');var p=a.validateObject(t.projetos,0);$('#projetos .pro input[type="checkbox"]').prop("checked",p.bo_nao_possui_projetos),$('#projetos .pro input[type="checkbox"]').change(function(){$(this).is(":checked")?$(this).prop("checked",!0):$(this).prop("checked",!1)}),$("#lista_projetos").append('<table id="table_lista_projetos" class="table-striped"></table>');var u=l[1],_=L(u);$("#table_lista_projetos tbody td").each(function(e){if(a.validateObject(u[e])){var o=h.carregaProjeto(u[e][0],i,s,a,!1).projeto.projeto[0].ft_nome_projeto;"Representante de OSC"!=o&&"Representante"!=o||$(this).append('<button id="id_botao-projeto" attr="'+u[e][0]+'" class="btn-danger btn botao-projeto">Remover Projeto</button>')}}),$("#table_lista_projetos").append('<span class="input-group-btn"><button id="add_projeto" class="btn-primary btn">Adicionar Projeto</button></span>'),$("#table_lista_projetos tbody td").each(function(){$(this).prepend('<span class="glyphicon glyphicon-book" aria-hidden="true"></span> '),$(this).wrapInner("<div class='titulo-projeto'></div>")});var b=0;$("#add_projeto").click(function(){_.row.add([-1,'<div class="titulo-projeto"><span class="glyphicon glyphicon-book" aria-hidden="true"></span> Novo Projeto']).draw(!1),verificarContraste()}),$("#table_lista_projetos").on("click",".titulo-projeto",function(){var o=$(this).parent().parent().get(0),t=!1,r=_.row(o).data()[0],l=$(this).next(".projeto");if(-1==r&&(t=!0,r=Number(r)-b,b+=1),l.length<1){var d=h.carregaProjeto(r,i,s,a,t),p=d.agrupadores,u=d.projeto,v=u?u.projeto[0].tx_identificador_projeto_externo:null,f="projeto-"+r;$(this).after('<div id="'+f+'" class="projeto col-md-12">'),0==$(this).find("#id_botao-projeto").length&&($(this).append('<button id="id_botao-projeto" attr="'+r+'" class="btn-danger btn botao-projeto">Remover Projeto</button>'),$(".botao-projeto").click(function(){c($(this).attr("attr"))})),function(o,t){R=e.createFactory(R),ReactDOM.render(R({dados:o}),document.getElementById("projeto-"+t)),$(".date").datepicker({dateFormat:"dd-mm-yy",changeYear:!0}),$(".ano").datepicker({dateFormat:"yy"}),$("#projeto-"+t).on("click",".btn-danger",function(){$(this).parents(".input-group").remove()}),$("#projeto-"+t).find(".fonte_recursos input[value='Recursos públicos']").bind("change",function(){$(this).prop("checked")?$("#projeto-"+t+" .tipo_parceria_projeto").removeClass("hidden"):$("#projeto-"+t+" .tipo_parceria_projeto").addClass("hidden")}),$("#projeto-"+t).find(".btn-primary").bind("click",function(){$(this).parent().siblings(".form-group").append('<div class="input-group"><div><input maxLength="100" class="form-control" placeholder="Insira a informação"></input></div><span class="input-group-btn"><button class="btn-danger btn">Remover</button></span></div>')})}(p,r),function(e){var o=e[0],t=e[1],a=$(".projeto #area_atuacao input"),i=(new AreaAtuacao,0);a.addClass("autocomplete"),a.append('<div class="checkboxList"></div>');for(var n=0;n<o.length;n++){var s=o[n];a.find(".checkboxList").append("<div>");for(var r=0;r<t.length;r++){var c=t[r];s.cd_area_atuacao,c.cd_area_atuacao}}o=$.map(o,function(e){return{label:e.tx_nome_area_atuacao,value:e.tx_nome_area_atuacao,id:e.cd_area_atuacao}}),$(".projeto .autocomplete").autocomplete({minLength:0,create:function(e,t){for(var a=$(this).attr("placeholder"),i=0;i<o.length;i++){if(o[i].value===a){var n=$(this).siblings(".checkboxList").find("#subareas-"+i);n.hasClass("hidden")&&n.toggleClass("hidden");for(var s=0;s<o.length;s++)if(a===o[s].tx_nome_area_atuacao){var r=!1;n.find("label").each(function(){o[s].tx_nome_subarea_atuacao===$(this).text().trim()&&(r=$(this))}),r?r.find("input").prop("checked",!0):n.find("#outros").val(o[s].tx_nome_subarea_atuacao)}}}},source:o,change:function(e,o){},select:function(e,t){"macro_area_1"==e.target.id?($("#sub_area_1_outros").parent().parent().addClass("hidden"),$("#sub_area_1_outros").val(""),$(this).parent().find(":checkbox").prop("checked",!1)):($("#sub_area_2_outros").parent().parent().addClass("hidden"),$("#sub_area_2_outros").val(""),$(this).parent().find(":checkbox").prop("checked",!1));var a=e.target,n=o.indexOf(t.item)+1;i=n;var s=$($(a).siblings(".checkboxList")[0]);s.children().each(function(e){$(this).hasClass("hidden")||($(this).toggleClass("hidden"),$(this).children().each(function(e){var o=$($(this).find("input")[0]);o.is(":checked")&&o.prop("checked",!1),"text"==o.prop("type")&&o.val("")}))});var r=s.find("#subareas-"+n);r.hasClass("hidden")&&r.toggleClass("hidden");var c=t.item.value,l=$(this).closest(".form-group"),n=l.find(".autocomplete").attr("id"),d=null;if(d="macro_area_1"===n?l.siblings().find("#macro_area_1_outros").closest(".form-group"):l.siblings().find("#macro_area_2_outros").closest(".form-group"),"Outros"===c){if(d.toggleClass("hidden"),d.hasClass("hidden")){(p=d.find("input")).val("")}}else if(!d.hasClass("hidden")){d.toggleClass("hidden");var p=d.find("input");p.val("")}}}),$(".autocomplete").on("click",function(){$(this).autocomplete("search","")}),$(".autocomplete").keyup(function(){if(""===$(this).val()&&0!=i){var e=i,o=$(this).parent().find("#subareas-"+e);o.hasClass("hidden")||o.toggleClass("hidden")}})}(n),$("#"+f+" #nr_valor_total_projeto input").mask("000.000.000.000.000,00",{reverse:!0}),$("#"+f+" #nr_valor_total_projeto input").addClass("with-pretext"),$("#"+f+" #nr_valor_total_projeto input").before('<span class="pretext">R$</span>'),$("#"+f+" #nr_valor_captado_projeto input").mask("000.000.000.000.000,00",{reverse:!0}),$("#"+f+" #nr_valor_captado_projeto input").addClass("with-pretext"),$("#"+f+" #nr_valor_captado_projeto input").before('<span class="pretext">R$</span>'),$("#"+f+" #nr_total_beneficiarios input").mask("00000000"),$($("#"+f).find("div")[0]).attr("id",v),H(f,$("#"+f+" #tx_nome_abrangencia_projeto").find(":selected").val()),$("#"+f+" .local button.btn-primary").click(function(){H(f,$("#"+f+" #tx_nome_abrangencia_projeto").find(":selected").val())}),$("#"+f+" #tx_nome_abrangencia_projeto").change(function(){H(f,$("#"+f+" #tx_nome_abrangencia_projeto").find(":selected").val())});var m=!1;$("#"+f+" .fonte_recursos input:checked").each(function(){"Recursos públicos"==$(this).val()&&(m=!0)}),$("#"+f+" .tipo_parceria_projeto").addClass(function(e,o){return 0!=e||o?"":"hidden"}($("#"+f+" .tipo_parceria_projeto input:checked").length,m)),$("#"+f+" .osc_parceira button.btn-primary").click(function(){K(function(e){var o=0;return $("#"+e+" .osc_parceira input").each(function(){o+=1}),o-1}(f))}),$("#"+f+" #osc_parceira").find("input").autocomplete({source:function(e,o){var t=$(this)[0].term,i="",n="";if(J(t)){var r=E(s.AutocompleteOSCByCnpj(a.replaceSpecialChars(t).replace(/ /g,"+"),10),!1);null==r?$("#"+f+" #osc_parceira").find("input")[0].value="Entidade não cadastrada!":(i=r[0].tx_nome_osc,n=r[0].id_osc,$("#"+f+" #osc_parceira").find("input")[0].value=i,$("#"+f+" #osc_parceira").find("input")[0].id_osc_parceira=n)}else;}}),u?(z(u.projeto[0]),B(u.projeto[0],r)):B({},r),verificarContraste()}else $(this).next(".projeto").toggleClass("hidden")}),$("#table_lista_projetos_paginate").click(function(e){var o=$("#lista_projetos .paginate_button.current").attr("data-dt-idx");o=10*(o-1),0==$("#id_botao-projeto").length&&$("#table_lista_projetos tbody td").each(function(e){if(a.validateObject(u[e+o])){var t=h.carregaProjeto(u[e+o][0],i,s,a,!1).projeto.projeto[0].ft_nome_projeto;"Representante de OSC"!=t&&"Representante"!=t||($(this).append('<button id="id_botao-projeto" attr="'+u[e+o][0]+'" class="btn-danger btn botao-projeto">Remover Projeto</button>'),$(this).prepend('<span class="glyphicon glyphicon-book" aria-hidden="true"></span> '),$(this).wrapInner("<div class='titulo-projeto'></div>"))}0==$(this).find(".glyphicon").length&&$(this).prepend('<span class="glyphicon glyphicon-book" aria-hidden="true"></span> ')}),$(".botao-projeto").click(function(){c($(this).attr("attr"))}),verificarContraste()}),$(".botao-projeto").click(function(){c($(this).attr("attr")),verificarContraste()})}function L(e){return $("#table_lista_projetos").DataTable({responsive:!0,deferLoading:1e3,deferRender:!0,ordering:!1,data:e,columns:[{DT_RowId:"Id"},{title:"Nome do Projeto"}],order:[],aoColumnDefs:[{bSortable:!1,aTargets:[0]},{targets:[0],visible:!1,searchable:!1}],autoWidth:!0,oLanguage:i.oLanguageDataTable()})}function z(e){for(var o,t=e.osc_parceira?e.osc_parceira.length:0,a=0;a<t;a++)o=n.validateObject(e.osc_parceira[a].id_osc,null),$("#osc_parceira").find("input")[a].id_osc_parceira=o}function B(e,o){t=e,a=o;var i=n.validateObject(e.objetivo_meta,""),r=n.validateObject(i[0],""),c=n.validateObject(r.tx_nome_objetivo_projeto,-1),l=n.validateObject(r.cd_objetivo_projeto,-1),d=[],p=[];if(-1!==c)for(b=0;b<i.length;b++){var u=i[b].cd_meta_projeto,_=i[b].tx_nome_objetivo_projeto;d.push(u),p.push(_)}for(var h={},b=0;b<i.length;b++)l=i[b].cd_objetivo_projeto,h[l]=i[b].tx_nome_objetivo_projeto;$.ajax({url:s.Objetivos(),type:"GET",dataType:"json",error:function(e){console.log("Erro no ajax: "),console.log(e)},success:function(t){if(""!=h)for(var a in h)N(o,h[a],a,d,t),Y(e,o,t);else N(o,"",l,d,t),Y(e,o,t);F(o,t)}})}function F(e,o){$("#projeto-"+e).append('<div class="col-md-12" id="objetivos-metas"><button id="id_botao-add-objetivo" class="btn-primary btn botao-add-objetivo">Adicionar ODS</button></div>'),$("#projeto-"+e).find(".botao-add-objetivo").on("click",function(){G($("#projeto-"+e),e,o,-1)})}function N(e,o,t,i,n){$("#projeto-"+e).append('<div class="col-md-12" id="objetivos-metas-'+t+'"</div>');var s=$("#projeto-"+e).find("#objetivos-metas-"+t);s.append('<div class="header" title="Indique se o PAP se relaciona com alguns dos objetivos do desenvolvimento sustentável, da ONU.">Objetivos do Desenvolvimento Sustentável - ODS: <span class="glyphicon glyphicon-info-sign" style="visibility:visible;" ></span><a href="http://www.agenda2030.com.br/" target=_blank><img class="imgLinkExterno" src="img/site-ext.gif" width="17" height="11" alt="Site Externo." title="Site Externo." /></a></div>'),s.append('<div class="form-group"><div id="objetivos-'+t+'"><select class="form-control"></select></div></div>');var r=s.find("select");-1==t?r.append('<option value=-1 selected id="0">Selecione uma opção...</option>'):r.append('<option value=-1 id="0">Selecione uma opção...</option>');for(var c=0;c<n.length;c++)n[c].cd_objetivo_projeto==t?r.append('<option selected id="'+n[c].cd_objetivo_projeto+'">'+n[c].tx_nome_objetivo_projeto+"</option>"):r.append('<option id="'+n[c].cd_objetivo_projeto+'">'+n[c].tx_nome_objetivo_projeto+"</option>");s.find("#objetivos-"+t+" select").selectBoxIt(),-1!=t&&V(t,i,e),s.find(".metas").each(function(){$(this).hasClass("hidden")||$(this).toggleClass("hidden")}),s.append('<div id="metas-'+e+t+'" class="metas"></div>'),s.find("#metas-"+e+t).append('<br><div class="header" title="Marque as metas que se enquadram neste projeto">Metas Relacionadas ao ODS definido:<span class="glyphicon glyphicon-info-sign" style="visibility:visible;"></span></div><br>'),s.find("#metas-"+e+t).append('<ol id="selectable-'+e+"-"+t+"-"+x+'" class="selectable"></ol><br>'),s.find("#metas-"+e+t).hasClass("hidden")&&s.find("#metas-"+e+t).toggleClass("hidden"),(oe=$("#projeto-"+e).find("#metas-"+e+t)).append('<button id="id_botao-rem-objetivo-'+t+'" class="btn-danger btn botao-rem-objetivo">Remover ODS</button>'),oe.find(".botao-add-objetivo").on("click",function(){G($("#projeto-"+a),a,n,t)}),oe.find(".botao-rem-objetivo").on("click",function(){U($(this),a)}),$("#projeto-"+e).append(s)}function U(e,o,t){n.contains("objetivo",e.parent()[0].id)?e.parent().remove():e.parent().parent().remove(),$("#projeto-"+o).find(".botao-add-objetivo").length<1&&F(o,t)}function G(e,o,t,i){x++;var s=n.validateObject(e.objetivo_meta,""),r=n.validateObject(s[0],""),c=[],l=[];if(-1!==n.validateObject(r.tx_nome_objetivo_projeto,-1))for(h=0;h<s.length;h++){var d=s[h].cd_meta_projeto,p=s[h].tx_nome_objetivo_projeto;c.push(d),l.push(p)}e.find(".botao-add-objetivo").remove(),e.append('<div class="col-md-12" id="objetivos-metas-'+i+"_"+x+'"</div>');var u=e.find("#objetivos-metas-"+i+"_"+x);u.append('<div class="header" title="Indique se o PAP se relaciona com alguns dos objetivos do desenvolvimento sustentável, da ONU.">Objetivos do Desenvolvimento Sustentável - ODS: <span class="glyphicon glyphicon-info-sign" style="visibility:visible;" ></span><a href="http://www.agenda2030.com.br/" target=_blank><img class="imgLinkExterno" src="img/site-ext.gif" width="17" height="11" alt="Site Externo." title="Site Externo." /></a></div>'),u.append('<div class="form-group"><div id="objetivos_'+i+"_"+x+'"><select class="form-control"></select></div></div>');var _=u.find("select");-1==i?_.append('<option value=-1 selected id="0">Selecione uma opção...</option>'):_.append('<option value=-1 id="0">Selecione uma opção...</option>');for(var h=0;h<t.length;h++)t[h].cd_objetivo_projeto==i?_.append('<option selected id="'+t[h].cd_objetivo_projeto+'">'+t[h].tx_nome_objetivo_projeto+"</option>"):_.append('<option id="'+t[h].cd_objetivo_projeto+'">'+t[h].tx_nome_objetivo_projeto+"</option>");u.find("#objetivos-"+i+" select").selectBoxIt(),-1!=i&&V(i,c,o),u.find("select").on("change",function(){var e=!1;1==u.find(".botao-rem-objetivo").length&&0==u.find(".botao-add-objetivo").length&&(e=!0),u.find(".botao-add-objetivo").remove(),u.find(".botao-rem-objetivo").remove();var i=$(this).children(":selected").attr("id");u.find(".metas").each(function(){$(this).hasClass("hidden")||$(this).toggleClass("hidden")}),u.append('<div id="metas-'+o+i+'" class="metas"></div>'),u.find("#metas-"+o+i).append('<br><div class="header" title="Marque as metas que se enquadram neste projeto">Metas Relacionadas ao ODS definido:<span class="glyphicon glyphicon-info-sign" style="visibility:visible;"></span></div><br>'),u.find("#metas-"+o+i).append('<ol id="selectable-'+o+"-"+i+"-"+x+'" class="selectable"></ol><br>'),u.find("#metas-"+o+i).hasClass("hidden")&&u.find("#metas-"+o+i).toggleClass("hidden"),0!==parseInt(i)&&V(i,[],o),e?u.append('<button id="id_botao-rem-objetivo-'+i+'" class="btn-danger btn botao-rem-objetivo">Remover ODS</button>'):u.append('<button id="id_botao-rem-objetivo-'+i+'" class="btn-danger btn botao-rem-objetivo">Remover ODS</button><div class="btn_ODS_add" ><button id="id_botao-add-objetivo" class="btn-primary btn botao-add-objetivo">Adicionar ODS</button></div>'),u.find(".botao-add-objetivo").on("click",function(){G($("#projeto-"+a),a,t,-1)}),u.find(".botao-rem-objetivo").on("click",function(){U($(this),a,t)})}),$("#projeto-"+o).append(u),verificarContraste()}function V(o,t,a){var i=o;o<1&&(i=""),$.ajax({url:s.MetaProjeto(i),type:"GET",dataType:"json",error:function(e){console.log("Erro no ajax: "),console.log(e)},success:function(i){!function(o,t,a,i){if(n.validateObject(o,!1)){for(var s=function(e,o,t,a,i){this.id=e,this.label=o,this.value=t,this.type=a,this.checked=i},r=[],c=o,l=0;l<c.length;l++){var d=null;a.includes(c[l].cd_meta_projeto)?(d=new s(c[l].cd_meta_projeto,c[l].tx_nome_meta_projeto,c[l].cd_meta_projeto,"checkbox",!0),r.push(d)):(d=new s(c[l].cd_meta_projeto,c[l].tx_nome_meta_projeto,c[l].cd_meta_projeto,"checkbox",!1),r.push(d))}O=e.createFactory(O),ReactDOM.render(O({dados:r}),document.getElementById("selectable-"+i+"-"+t+"-"+x))}}(i,o,t,a)}})}function Y(e,o,t){$(".objetivos").find("select").on("change",function(){var e=$(this).children(":selected").attr("id"),a=$(this).parents("#objetivos-metas");a.find(".metas").each(function(){$(this).hasClass("hidden")||$(this).toggleClass("hidden")}),a.find(".metas").remove(),a.append('<div id="metas-'+e+'" class="metas"></div>'),$("#metas-"+e).append('<br><div class="header" title="Marque as metas que se enquadram neste projeto">Metas Relacionadas ao ODS definido:<span class="glyphicon glyphicon-info-sign" style="visibility:visible;"></span></div><br>'),$("#metas-"+e).append('<ol id="selectable-'+o+"-"+e+"-"+x+'" class="selectable"></ol><br>'),$("#metas-"+e).append('<button id="id_botao-add-objetivo" class="btn-primary btn botao-add-objetivo">Adicionar ODS</button><button id="id_botao-rem-objetivo-'+e+'" class="btn-danger btn botao-rem-objetivo">Remover ODS</button>'),$("#metas-"+e).find(".botao-add-objetivo").on("click",function(){G($("#projeto-"+o),o,t,e)}),$("#metas-"+e).find(".botao-rem-objetivo").on("click",function(){U($(this),o,t)}),$("#metas-"+e).hasClass("hidden")&&$("#metas-"+e).toggleClass("hidden"),0!==parseInt(e)&&(x++,V(e,[],o)),verificarContraste()})}function W(e){var o=parseInt($("#modal_loading .progress").width()/12*e),t=parseInt(100*o/$("#modal_loading .progress").width());$("#modal_loading .progress-bar").css("width",o),$("#modal_loading .progress-bar").attr("aria-valuenow",t)}function H(e,o){var t="",a=o.toLowerCase();$("#"+e+" #localizacao_projeto .form-control").autocomplete({minLength:3,source:function(e,o){if("estadual"==a||"municipal"==a||"-1"==a?t=s.AutocompleteOSCByCounty(n.replaceSpecialChars(e.term).replace(/ /g,"+"),25):"regional"!=a&&"nacional"!=a||(t=s.AutocompleteOSCByState(n.replaceSpecialChars(e.term).replace(/ /g,"+"),10)),""!=t){var i=E(t,!1);o($.map(i,function(e){return"estadual"==a||"municipal"==a||"-1"==a?{label:e.edmu_nm_municipio+" - "+e.eduf_sg_uf,value:e.edmu_nm_municipio+" - "+e.eduf_sg_uf,id:e.edmu_cd_municipio}:"regional"==a||"nacional"==a?{label:e.eduf_nm_uf,value:e.eduf_nm_uf,id:e.eduf_cd_uf}:void 0}))}}})}function J(e){if(""==(e=e.toString().replace(/[^\d]+/g,""))||14!=e.length)return!1;for(var o=e.length-2,t=e.substring(0,o),a=e.substring(o),i=0,n=o-7,s=o;s>=1;s--)i+=t.charAt(o-s)*n--,n<2&&(n=9);var r=i%11<2?0:11-i%11;if(r!=a.charAt(0))return!1;o+=1,t=e.substring(0,o),i=0,n=o-7;for(s=o;s>=1;s--)i+=t.charAt(o-s)*n--,n<2&&(n=9);return(r=i%11<2?0:11-i%11)==a.charAt(1)}function K(e){var o="",t="";$("#osc_parceira").find("input").autocomplete({source:function(a,i){var r=$(this)[0].term;if(J(r)){var c=E(s.AutocompleteOSCByCnpj(n.replaceSpecialChars(r).replace(/ /g,"+"),10),!1);null==c?$("#osc_parceira").find("input")[e].value="Entidade não cadastrada! ":(o=c[0].tx_nome_osc,t=c[0].id_osc,$("#osc_parceira").find("input")[e].value=o,$("#osc_parceira").find("input")[e].id_osc_parceira=t)}else;}})}function Q(){function e(e,o){var t=[];return e.each(function(){var e=$(this).closest(".form-group"),o=$(this).val();if("-1"===o&&(o=""),void 0===e.attr("id")&&(e=$(this).parent()),$(this).closest(".metas").length>0)e=$(this).closest(".metas")[0],void 0===t.objetivo_meta&&(t.objetivo_meta=[]),$(this).prop("checked")&&t.objetivo_meta.push({cd_meta_projeto:o});else if("fonte_recursos"===e.attr("id")){void 0===t[e.attr("id")]&&(t[e.attr("id")]=[]);var a=null;if($(this).prop("checked")){switch($(this).val()){case"Recursos públicos":a=1;break;case"Recursos privados":a=2;break;case"Recursos não financeiros":a=3;break;case"Recursos próprios":a=4;break;default:a=null}null!=t[e.attr("id")]&&t[e.attr("id")].push({cd_origem_fonte_recursos_projeto:a})}}else if("tipo_parceria"===e.attr("id")){void 0===t[e.attr("id")]&&(t[e.attr("id")]=[]);var i=null;if(t.fonte_recursos[0]&&1==t.fonte_recursos[0].cd_origem_fonte_recursos_projeto&&$(this).prop("checked")){switch($(this).val()){case"Termo de fomento":i=0;break;case"Termo de colaboração":i=1;break;case"Termo de parceria":i=2;break;case"Contrato de gestão":i=3;break;case"Convênio":i=4;break;case"Acordo de cooperação técnica":i=5;break;case"Outro":i=6;break;default:i=null}null!=t[e.attr("id")]&&t[e.attr("id")].push({cd_tipo_parceria_projeto:i})}}else if("area_atuacao_outra"===e.attr("id"))Array.isArray(t[e.attr("id")])?t[e.attr("id")].push({cd_area_atuacao_projeto:$(this).attr("id")?$(this).attr("id"):null,tx_area_atuacao_projeto:o}):(t[e.attr("id")]=[],t[e.attr("id")].push({cd_area_atuacao_projeto:$(this).attr("id")?$(this).attr("id"):null,tx_area_atuacao_projeto:o}));else if(null!=e.attr("id")&&null!=e.attr("id").match("objetivos")&&e.attr("id").match("objetivos").length>0);else if("tx_nome_status_projeto"===e.attr("id")){var n=null;"Proposta"===o&&(n=1),"Projeto em andamento"===o&&(n=2),"Finalizado"===o&&(n=3),"Arquivado, cancelado ou indeferido"===o&&(n=5),"Outro"===o&&(n=4),t.cd_status_projeto=n}else if("tx_nome_abrangencia_projeto"===e.attr("id")){var s=null;"Municipal"===o&&(s=1),"Estadual"===o&&(s=2),"Regional"===o&&(s=3),"Nacional"===o&&(s=4),t.cd_abrangencia_projeto=s}else if("tx_nome_zona_atuacao"===e.attr("id")){var r=null;"Urbana"===o&&(r=1),"Rural"===o&&(r=2),t.cd_zona_atuacao_projeto=r}else if("localizacao_projeto"===e.attr("id")){var c=[],l={};(v=e.find("input")).each(function(){""!==$(this).val()&&((l={}).tx_nome_regiao_localizacao_projeto=$(this).val(),c.push(l))}),t.localizacao=c.length>0?c:null}else if("publico_beneficiado"===e.attr("id")){var d=[],p={};(v=e.find("input")).each(function(){""!==$(this).val()&&((p={}).tx_nome_publico_beneficiado=$(this).val(),d.push(p))}),t.publico_beneficiado=d.length>0?d:null}else if("financiador_projeto"===e.attr("id")){var u=[],_={};(v=e.find("input")).each(function(){""!==$(this).val()&&((_={}).tx_nome_financiador=$(this).val(),u.push(_))}),t.financiador_projeto=u.length>0?u:null}else if("osc_parceira"===e.attr("id")){var h=[],b={},v=e.find("input");v.each(function(){""!==$(this).val()&&((b={}).id_osc=$(this)[0].id_osc_parceira?$(this)[0].id_osc_parceira:null,h.push(b))}),t.osc_parceira=null==h?null:h.length>0?h:null}else t[e.attr("id")]=o}),"input"==o&&(void 0!==t.fonte_recursos&&0!=t.fonte_recursos.length||(t.fonte_recursos=null),void 0!==t.tipo_parceria&&0!=t.tipo_parceria.length||(t.tipo_parceria=null)),t.bo_nao_possui_projetos=$('#projetos .pro input[type="checkbox"]').is(":checked"),t}var t=0;$(".projeto").each(function(){var a={};if(a.headers=ee,a.id_osc=Z,!$(this).hasClass("projeto-salvo")){var i=$(this).attr("id"),r=(i.substr(0,i.indexOf("-")),i.substr(i.indexOf("-")+1)),c=$($(this).find("div")[0]).attr("id");if(t=Number(r),c=c||null,a=$.extend({},a,e($(this).find("input"),"input")),a=$.extend({},a,e($(this).find("textarea"),"textarea")),void 0===(a=$.extend({},a,e($(this).find("select"),"select"))).objetivo_meta&&(a.objetivo_meta=null),t<0){a.id_projeto=null,a.tx_identificador_projeto_externo=c;var l=["localizacao","publico_beneficiado","financiador_projeto","osc_parceira"];l.map(function(e){a.hasOwnProperty(e)||(a[e]=null)}),"Projeto adicionado."===(o=n.carregaAjax(s.CriarProjectByID(Z),"POST",a)).msg&&($(this).addClass("hidden"),$(this).addClass("projeto-salvo"),$(this).prev().append(" - "+a.tx_nome_projeto))}else a.id_projeto=t,a.tx_identificador_projeto_externo=c,(l=["localizacao","publico_beneficiado","financiador_projeto","osc_parceira"]).map(function(e){a.hasOwnProperty(e)||(a[e]=null)}),o=n.carregaAjax(s.AtualizarProjectByID(Z),"POST",a)}})}var X=void 0!==window.location.href.split("#")[1]?window.location.href.split("#/")[1].split("="):null,Z="";null!==X&&(Z=X[0],n.verificarPermissao(Z)||(window.location.href="visualizar-osc.html#/"+Z),function(e){$(".btnVisualizar").append('<a id="btnVisualizar" type="button" title="Clique para Visualizar"  class="btn btn-info btn-sm"><span class="glyphicon glyphicon-search" aria-hidden="true"></span> Visualizar OSC</a>'),$("#btnVisualizar").attr("href","visualizar-osc.html#/"+e)}(Z),function(e){$("#voltaEditar").attr("href","editar-osc.html#/"+e),-1==document.referrer.indexOf("minhas-oscs")?($("#voltaPagAnterior").text("Visualizar"),$("#voltaPagAnterior").attr("href","visualizar-osc.html#/"+e)):($("#voltaPagAnterior").text("Lista de OSCs"),$("#voltaPagAnterior").attr("href","minhas-oscs.html"))}(Z),s.OSCByID_no_project(Z));var ee={User:window.localStorage.getItem("User"),Authorization:window.localStorage.getItem("Authorization")},oe="";f.headers=ee,f.id_osc=Z,$.ajax({url:s.OSCByID_no_project(Z),type:"GET",dataType:"json",error:function(e){console.log("Erro no ajax: "),console.log(e)},success:function(o){r.montarCabecalho(o,n,e,ReactDOM,y),v=o,c.montarDadosGerais(o,n,i,e,ReactDOM,k,O),function(e,o){for(var t=n.validateObject(e.dados_gerais.objetivo_metas,""),a={},i=0;i<t.length;i++)a[t[i].cd_objetivo_osc]=t[i].tx_nome_objetivo_osc;var r=$("#dados_gerais");if(r.append('<label title="Indique se o PAP se relaciona com alguns dos objetivos do desenvolvimento sustentável, da ONU.">Objetivos do Desenvolvimento Sustentável - ODS: <span class="glyphicon glyphicon-info-sign" style="visibility:visible;" ></span><a href="http://www.agenda2030.com.br/" target=_blank><img class="imgLinkExterno" src="img/site-ext.gif" width="17" height="11" alt="Site Externo." title="Site Externo." /></a></label>'),r.append('<div class="form-group" id="objetivosOsc-metas"</div>'),$("#objetivosOsc-metas").append('<span class="input-group-btn"><button id="add_objetivo_ods" class="btn-primary btn">Adicionar Objetivo</button></span>'),e=T(s.Objetivos(),!1),""==t)I(e,"",-1,-1,o),m++,j++;else for(var c in a)I(e,t,n.validateObject(a[c],-1),c,o),m++;$("#add_objetivo_ods").click(function(){m<g&&(I(T(s.Objetivos(),!1),"",-1,-j,o),m++,j++)})}(o,O);var t=n.validateObject(o.dados_gerais.tx_nome_atividade_economica_osc,""),a=n.validateObject(o.dados_gerais.ft_atividade_economica_osc,""),h=l.montarAreasDeAtuacao(o,n,i,s,t,a,e,ReactDOM,k);d.montarDescricao(o,n,i,e,ReactDOM,k),p.montarTitulosCertificacoes(o,n,e,ReactDOM,k,D);var f=u.montarRelacoesGovernanca(o,n,i);u.ativarTrabalhoGovernanca(i,f,e,ReactDOM,C,S,k,P,n);var x=_.iniciarEspacosPartSoc(o,n,i,C,e,ReactDOM,s.Conselho(),s.Conferencia(),s.PeriodicidadeReuniao(),s.Titularidade(),s.FormaParticipacaoConferencia());_.ativarEspacosPart(x,n,e,ReactDOM,S,w,A,P),function(e){$("#tx_sigla_osc").parent().parent().prepend('<div class="input-box checkbox box_right"><label><input type="checkbox">Não possui sigla</label></div>'),$("#tx_email").parent().parent().prepend('<div class="input-box checkbox box_right"><label><input type="checkbox">Não possui email</label></div>'),$("#tx_site").parent().parent().prepend('<div class="input-box checkbox box_right"><label><input type="checkbox">Não possui site</label></div>');var o=n.validateObject(e.dados_gerais,0);$("#tx_sigla_osc").parent().parent().find('input[type="checkbox"]').prop("checked",o.bo_nao_possui_sigla_osc),$("#tx_email").parent().parent().find('input[type="checkbox"]').prop("checked",o.bo_nao_possui_email),$("#tx_site").parent().parent().find('input[type="checkbox"]').prop("checked",o.bo_nao_possui_site),$('#dados_gerais .box_right input[type="checkbox"]').change(function(){$(this).is(":checked")?$(this).prop("checked",!0):$(this).prop("checked",!1)}),$("#tx_link_estatuto_osc").parent().parent().prepend('<div class="input-box checkbox box_right"><label><input type="checkbox">Não possui link para o estatuto da OSC</label></div>');var t=n.validateObject(e.descricao,0);$("#tx_link_estatuto_osc").parent().parent().find('input[type="checkbox"]').prop("checked",t.bo_nao_possui_link_estatuto_osc),$('#descricao input[type="checkbox"]').change(function(){$(this).is(":checked")?$(this).prop("checked",!0):$(this).prop("checked",!1)}),$("#novo_titulo_certificacao_botao").parent().append('<div class="input-box checkbox"><label><input type="checkbox">Não possui títulos e certificações.</label></div>');var a=n.validateObject(e.certificado,0);$("#novo_titulo_certificacao_botao").click(function(){$("#idSelectTitulosCertificados").change(function(){var e="",o=$("#idSelectTitulosCertificados")[0].value.toLowerCase();$("#novo_titulo_certificacao_local").autocomplete({minLength:2,source:function(t,a){if(n.contains("municipal",o)?e=s.AutocompleteOSCByCounty(n.replaceSpecialChars(t.term).replace(/ /g,"+"),25):(n.contains("estadual",o)||"-1"==o)&&(e=s.AutocompleteOSCByState(n.replaceSpecialChars(t.term).replace(/ /g,"+"),10)),""!=e){var i=E(e,!1);a($.map(i,function(e){return n.contains("municipal",o)?{label:e.edmu_nm_municipio+" - "+e.eduf_sg_uf,value:e.edmu_nm_municipio+" - "+e.eduf_sg_uf,id:e.edmu_cd_municipio}:n.contains("estadual",o)||"-1"==o?{label:e.eduf_nm_uf,value:e.eduf_nm_uf,id:e.eduf_cd_uf}:void 0}))}},select:function(e,o){$("#cd_uf_mun_titulo_certificacao").val(o.item.id)}})})}),$('#certificacoes input[type="checkbox"]').prop("checked",a.bo_nao_possui_certificacoes),$('#certificacoes input[type="checkbox"]').change(function(){$(this).is(":checked")?$(this).prop("checked",!0):$(this).prop("checked",!1)}),$("#conselhos").prepend('<div class="input-box checkbox"><label><input type="checkbox">Não possui conselhos de políticas públicas.</label></div>'),$("#conferencias").prepend('<div class="input-box checkbox"><label><input type="checkbox">Não possui conferências de políticas públicas.</label></div>'),$("#outros_part").prepend('<div class="input-box checkbox"><label><input type="checkbox">Não possui outros espaços de participação social.</label></div>');var i=n.validateObject(e.participacao_social,0);$('#conselhos input[type="checkbox"]').prop("checked",i.bo_nao_possui_conselhos),$('#conferencias input[type="checkbox"]').prop("checked",i.bo_nao_possui_conferencias),$('#outros_part input[type="checkbox"]').prop("checked",i.bo_nao_possui_outros_part),$('#conselhos input[type="checkbox"]').change(function(){$(this).is(":checked")?$(this).prop("checked",!0):$(this).prop("checked",!1)}),$('#conferencias input[type="checkbox"]').change(function(){$(this).is(":checked")?$(this).prop("checked",!0):$(this).prop("checked",!1)}),$('#outros_part input[type="checkbox"]').change(function(){$(this).is(":checked")?$(this).prop("checked",!0):$(this).prop("checked",!1)})}(o),q(o,n,i,h),b.montarFontedeRecursos(o,n,s,i,e,ReactDOM,C,k),verificarContraste(),function(){var e=i.jsonModalAjuda();$(".ajuda").on("click",function(){n.abrirModalAjuda($(this).attr("data"),e)})}(),$(".date").datepicker({dateFormat:"dd-mm-yy",changeYear:!0}),$(function(){$(".ano").datepicker({changeYear:!0,showButtonPanel:!0,dateFormat:"yy",yearRange:"1900:2017",onClose:function(e,o){var t=$("#ui-datepicker-div .ui-datepicker-year :selected").val();$(this).datepicker("setDate",new Date(t,1))}}),$(".ano").focus(function(){$(".ui-datepicker-calendar").hide(),$(".ui-datepicker-month").hide(),$(".ui-datepicker-prev").hide(),$(".ui-datepicker-next").hide()}),$("#tx_telefone input.form-control").focusout(function(e){var o,t,a;t=(o=e.currentTarget?e.currentTarget:e.srcElement).value.replace(/\D/g,""),(a=$(o)).unmask(),11===t.length?0==t[0]?a.mask("9999 999 9999"):a.mask("(99) 99999-9999"):10===t.length?a.mask("(99) 9999-9999"):9===t.length?a.mask("(99) 999-9999"):8===t.length?a.mask("9999-9999"):7===t.length&&a.mask("999-9999")}),$("#tx_telefone input.form-control").focusin(function(e){var o;o=e.currentTarget?e.currentTarget:e.srcElement,$(o).unmask()})}),$("#bodyheaderTitulosCertificacoes td.sorting_1").click(function(){$(".remove_titulo_certificacao").attr("data");$("#tabela_titulos_certificados").DataTable().destroy()}),$("#btnInserirImg").append('<label class="custom-file-upload btn btn-info" title="Clique para Inserir o Logo da OSC"><input id="inserirLogo" type="file" accept="image/x-png,image/gif,image/jpeg" /><i class="fa fa-cloud-upload"></i>Inserir Logo</label>'),$("#btnRemoverImg").append('<a class="btn btn-danger btn-sm" id="btnRemoverLogo" type="button" title="Clique para Remover o Logo da OSC" ><span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Remover Logo</a>'),$(".custom-file-upload").on("change",function(){$(".alert").addClass("hide"),$("input[type=file]").each(function(e){""!=$("input[type=file]").eq(e).val()&&function(e){if(e.files&&e.files[0]&&e.files[0].type.match("image.*")&&e.files[0].size<1e6){var o=document.createElement("img"),t=document.createElement("canvas"),a=new FileReader;a.onload=function(e){o.src=e.target.result,o.onload=function(){var e=o.width,a=o.height;e>a?e>300&&(a*=300/e,e=300):a>225&&(e*=225/a,a=225),t.width=e,t.height=a,t.getContext("2d").drawImage(o,0,0,e,a);var i=t.toDataURL("image/png");$("#imagemLogo").attr("src",i)}},a.readAsDataURL(e.files[0])}else $("#errorLabel").removeClass("hide")}(this)})}),$("#btnRemoverLogo").click(function(){$("#imagemLogo").attr("src","img/camera.jpg"),$("input[type=file]").eq(0).val("")}),$("#loading").hide(),$(".conteudo_loading .section").css("visibility","visible")}}),$("#cancelar").click(function(){window.location.href="/visualizar-osc.html#/"+Z}),$("#salvar").click(function(){$("#modal_loading").modal("show"),setTimeout(function(){!function(){var e=0,o="",t={};t.headers=ee,t.id_osc=Z,$("#dados_gerais input:not(:checkbox)").each(function(){var e=$(this).attr("id"),o=$(this).val();t[e]=o}),$("#dados_gerais textarea").each(function(){var e=$(this).attr("id"),o=$(this).val();t[e]=o}),$("#tx_nome_situacao_imovel_osc").each(function(){var e=$(this).val();t.cd_situacao_imovel_osc="Próprio"===e?1:"Alugado"===e?2:"Cedido"===e?3:"Comodato"===e?4:null}),t.bo_nao_possui_sigla_osc=$("#tx_sigla_osc").parent().parent().find('input[type="checkbox"]').is(":checked"),t.bo_nao_possui_email=$("#tx_email").parent().parent().find('input[type="checkbox"]').is(":checked"),t.bo_nao_possui_site=$("#tx_site").parent().parent().find('input[type="checkbox"]').is(":checked"),t.objetivo_metas=[],$("#objetivosOsc-metas :input:checkbox").each(function(){if($(this).prop("checked")){var e=$(this).attr("value");t.objetivo_metas.push({cd_meta_osc:e})}});var a=$("#imagemLogo").attr("src");t.im_logo="img/camera.jpg"==a||null==a||void 0==a?null:a,o=n.carregaAjax(s.DadosGerais(Z),"POST",t),W(e+=1),(t=n.validateObject(v.area_atuacao,{})).headers=ee,t.id_osc=Z,t.area_atuacao=[];var r=i.getSuggestions();$("#areas_de_atuacao .autocomplete").each(function(){for(var e=0,o=0;o<r.length;o++)$(this).val().trim().toLowerCase()===r[o].tx_nome_area_atuacao.trim().toLowerCase()&&(e=r[o].cd_area_atuacao);var a=$(this).attr("id").substring(11),i=$("#macro_area_"+a+"_outros").val(),n={cd_area_atuacao:e.toString(),tx_nome_area_atuacao_outra:"Outros"===$(this).val()?i:null},s=[];$(this).siblings(".checkboxList").children(":not(.hidden)").each(function(e){$(this).find("input:checked").each(function(){$(this).closest("label").text();var e="Outros"===$(this).closest("label").text();s.push({tx_nome_subarea_atuacao_outra:e?$("#sub_area_"+a+"_outros").val():null,cd_subarea_atuacao:$(this).val()})}),s.length<=0&&(s=null),n.subarea_atuacao=s,t.area_atuacao.push(n)}),0==t.area_atuacao.length&&t.area_atuacao.push({cd_area_atuacao:0,tx_nome_area_atuacao_outra:null,subarea_atuacao:null})}),o=n.carregaAjax(s.AtualizarAreaAtuacao(Z),"POST",t),W(e+=1),(t=n.validateObject(v.descricao,{})).headers=ee,t.id_osc=Z,t.descricao=[],$("#descricao textarea").each(function(){t[$(this).attr("id")]=$(this).val()}),t.bo_nao_possui_link_estatuto_osc=$("#tx_link_estatuto_osc").parent().parent().find('input[type="checkbox"]').is(":checked"),o=n.carregaAjax(s.Descricao(Z),"POST",t),W(e+=1),(t=n.validateObject(v.certificado,{})).headers=ee,t.id_osc=Z,t.certificado=[],$("#tabela_titulos_certificados tbody tr").each(function(e){var o=0;switch($(".tipo_titulo_certificado",this).text(),$(".tipo_titulo_certificado",this).text()){case"Utilidade Pública Estadual":o=7;break;case"Utilidade Pública Municipal":o=8;break;case"Utilidade Pública Federal":o=5;break;case"Entidade Ambientalista":o=1;break;case"CEBAS - Educação":o=2;break;case"CEBAS - Saúde":o=3;break;case"OSCIP":o=4;break;case"CEBAS - Assistência Social":o=6}var a={},i=$(".tipo_titulo_certificado span",this).attr("title");a.bo_oficial="Representante de OSC"!=i&&"Representante"!=i,a.dt_inicio_certificado="Não informado"!=$(".data_inicio_validade_titulo_certificado",this).text()?$(".data_inicio_validade_titulo_certificado",this).text():"",a.dt_fim_certificado=$(".data_fim_validade_titulo_certificado",this).text(),a.ft_certificado=i,a.ft_inicio_certificado=i,a.ft_fim_certificado=i,a.ft_local_certificado=i,a.cd_certificado=o,7==o?a.cd_uf=$(".local_titulo_certificado",this).attr("data-cod"):8==o&&(a.cd_municipio=$(".local_titulo_certificado",this).attr("data-cod")),a.id_certificado=$(this).prop("id"),o>0&&t.certificado.push(a)}),t.bo_nao_possui_certificacoes=$('#certificacoes input[type="checkbox"]').is(":checked"),t.headers=ee,t.id_osc=Z,o=n.carregaAjax(s.Certificado(Z),"POST",t),W(e+=1),(t={}).headers=ee,t.id_osc=Z,t.governanca=[];var c={};$("#dirigentes").find("input").each(function(e){$(this)[0].value&&(e%2==0?(c.id_dirigente=$(this).attr("id")?$(this).attr("id"):null,c.tx_nome_dirigente=$(this)[0].value,c.ft_nome_dirigente="Representante de OSC"):(c.tx_cargo_dirigente=$(this)[0].value,c.ft_cargo_dirigente="Representante de OSC",t.governanca.push(c),c={}))}),0==t.governanca.length&&(t.governanca=null),o=n.carregaAjax(s.Dirigente(Z),"POST",t),W(e+=1),(t={}).headers=ee,t.id_osc=Z,t.conselho_fiscal=[],$("#conselho_fiscal").find("input").each(function(){if($(this)[0].value){var e={};e.id_conselheiro=$(this).attr("id")?$(this).attr("id"):null,e.tx_nome_conselheiro=$(this)[0].value,e.ft_nome_conselheiro="Representante de OSC",t.conselho_fiscal.push(e)}}),0==t.conselho_fiscal.length&&(t.conselho_fiscal=null),o=n.carregaAjax(s.ConselhoFiscal(Z),"POST",t),W(e+=1),t.nr_trabalhadores_voluntarios=$("#voluntarios").val(),o=n.carregaAjax(s.RelacoesTrabalho(Z),"POST",t),W(e+=1);var l=[];l=T(s.Titularidade(),!1);var d=[];d=T(s.Conselho(),!1);var p=[];p=T(s.PeriodicidadeReuniao(),!1),(t={}).headers=ee,t.id_osc=Z,t.conselho=[],t.bo_nao_possui_conselhos=$('#conselhos input[type="checkbox"]').is(":checked"),$(".conselho").each(function(){var e={};e.conselho={},e.representante=[];var o=0,a=0;$(this).find("select").each(function(){for($(this).attr("id").split("-")[0],a=parseInt($(this).attr("id").split("-")[1]),e.conselho.id_conselho=0==a?null:a,t=0;t<d.length;t++)if($(this).val()===d[t].tx_nome_conselho){e.conselho.cd_conselho=d[t].cd_conselho,o=e.conselho.cd_conselho;break}for(t=0;t<l.length;t++)if($(this).val()===l[t].tx_nome_tipo_participacao){e.conselho.cd_tipo_participacao=l[t].cd_tipo_participacao;break}for(var t=0;t<p.length;t++)if($(this).val()===p[t].tx_nome_periodicidade_reuniao_conselho){e.conselho.cd_periodicidade_reuniao_conselho=p[t].cd_periodicidade_reuniao_conselho;break}}),$(this).find("input").each(function(o){var t=$(this).attr("id").split("-")[0];0!==e.conselho.cd_conselho&&("outro_conselho"==t&&""!=$(this).val()&&(e.conselho.tx_nome_conselho_outro=$(this).val()),"tx_nome_representante_conselho"==t&&""!=$(this).val()&&e.representante.push({tx_nome_representante_conselho:$(this).val()})),"dt_data_inicio_conselho"==t&&""!=$(this).val()&&(e.conselho.dt_data_inicio_conselho=$(this).val()),"dt_data_fim_conselho"==t&&""!=$(this).val()&&(e.conselho.dt_data_fim_conselho=$(this).val())}),0!==e.representante.length&&null!==n.validateObject(e.conselho.cd_conselho,null)&&t.conselho.push(e)}),0==Object.keys(t.conselho).length&&(t.conselho=null),o=n.carregaAjax(s.ParticipacaoSocialConselho(Z),"POST",t),W(e+=1);var u=["Membro de comissão organizadora nacional","Membro de comissão organizadora estadual ou distrital","Membro de comissão organizadora municipal","Delegado para etapa nacional","Delegado para etapa estadual ou distrital","Participante de etapa municipal","Participante de conferência livre ou virtual","Palestrante ou convidado","Observador","Mediador, moderador ou relator","Outro"],_=[1,2,3,4,5,6,7,8,9,10,11],h={};$.ajax({url:s.Conferencia(),type:"GET",async:!1,dataType:"json",error:function(e){console.log("Erro no ajax: "),console.log(e)},success:function(o){h=o,W(e+=1)}}),(t={}).headers=ee,t.id_osc=Z,t.conferencia=[],t.bo_nao_possui_conferencias=$('#conferencias input[type="checkbox"]').is(":checked"),$(".conferencia").each(function(){var e={},o=0;$(this).find("select").each(function(){for($(this).attr("id").split("-")[0],t=0;t<h.length;t++)if($(this).val()===h[t].tx_nome_conferencia){e.cd_conferencia=h[t].cd_conferencia,o=parseInt($(this).attr("id").split("-")[1]),e.tx_nome_conferencia="";break}for(var t=0;t<u.length;t++)if($(this).val()===u[t]){e.cd_forma_participacao_conferencia=_[t];break}}),$(this).find("input").each(function(){for("outro_conferencia"==$(this).attr("id").split("-")[0]&&""!=$(this).val()&&(e.tx_nome_conferencia_outra=$(this).val()),o=0;o<h.length;o++)if($(this).val()===h[o].tx_nome_conferencia){e.cd_conferencia=h[o].cd_conferencia;break}for(var o=0;o<u.length;o++)if($(this).val()===u[o]){e.cd_forma_participacao_conferencia=_[o];break}(n.contains("19",$(this).val())||n.contains("20",$(this).val()))&&(e.dt_ano_realizacao=$(this).val())}),$.isEmptyObject(e)||(e.id_conferencia=0!=o?o:null,t.conferencia.push(e))}),0==Object.keys(t.conferencia).length&&(t.conferencia=null),o=n.carregaAjax(s.ParticipacaoSocialConferencia(Z),"POST",t),W(e+=1),(t={}).headers=ee,t.id_osc=Z,t.outra=[],t.bo_nao_possui_outros_part=$('#outros_part input[type="checkbox"]').is(":checked"),$("#outros_part").find("div").children(".form-group").each(function(){$(this).find("input").each(function(){var e=$(this).attr("id").split("-")[0];if(""!==$(this).val()){var o={};o[e]=$(this).val(),t.outra.push(o)}})}),0==Object.keys(t.outra).length&&(t.outra=null),o=n.carregaAjax(s.OutraParticipacaoSocial(Z),"POST",t),W(e+=1),Q(),(t={}).headers=ee,t.id_osc=Z,$("#recursos").children().each(function(){var a=$(this).find("select").val(),i=$("#recursos_geral-"+a+' input[type="checkbox"]').is(":checked"),r=$("#recursos_publicos-"+a+' input[type="checkbox"]').is(":checked"),c=$("#recursos_proprios-"+a+' input[type="checkbox"]').is(":checked"),l=$("#recursos_privados-"+a+' input[type="checkbox"]').is(":checked"),d=$("#recursos_nao_financeiros-"+a+' input[type="checkbox"]').is(":checked");t.dt_ano_recursos_osc=a,t.bo_nao_possui=i,t.nao_possui_recursos_proprios=c,t.nao_possui_recursos_publicos=r,t.nao_possui_recursos_privados=l,t.nao_possui_recursos_nao_financeiros=d,i&&(t.nao_possui_recursos_proprios=!0,t.nao_possui_recursos_publicos=!0,t.nao_possui_recursos_privados=!0,t.nao_possui_recursos_nao_financeiros=!0),t.recursos=[],i||$(this).find('input:not([type="checkbox"])').each(function(){var e={},o=$(this).val().replace(/\./g,"");""!=(o=o.replace(/,/g,"."))&&(e.cd_fonte_recursos_osc=$(this).attr("id"),e.nr_valor_recursos_osc=parseFloat(o),t.recursos.push(e))}),o=n.carregaAjax(s.AtualizarFontesRecursos(Z),"POST",t),(t={}).headers=ee,t.id_osc=Z,W(e+=1)}),$("#modal_loading").modal("hide"),n.abrirModalAjuda("Salvo com sucesso!",{"Salvo com sucesso!":"Suas alterações serão processadas aproximadamente em instantes.<br><br>Obrigado!"})}()},1e3)})})});